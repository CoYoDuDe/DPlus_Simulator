#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "${SCRIPT_DIR}/../.." && pwd)"
CONFIG_PATH="${CONFIG_PATH:-${PROJECT_ROOT}/etc/dplus_sim/settings.json}"
INIT_FLAGS=()

if [[ ! -f "${CONFIG_PATH}" ]]; then
  mkdir -p "$(dirname "${CONFIG_PATH}")"
  INIT_FLAGS+=("--write-defaults")
fi

export PYTHONUNBUFFERED=1
exec python3 "${PROJECT_ROOT}/src/dplus_sim.py" --config "${CONFIG_PATH}" "${INIT_FLAGS[@]}" "$@"
